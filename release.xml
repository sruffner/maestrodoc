<?xml version="1.0" encoding="UTF-8"?>

<project name="MaestroDoc Packaging" default="init" basedir=".">

   <!-- NOTE: JMXDoc uses the JSON library package org.json, which is also in the figurecomposer/common module. When I
        moved from Eclipse to IntelliJ IDEA, I decided to just include a copy of org.json in this small project. The
        org.json classes are included in the hhmi-ms-maestro.jar file generated by this Ant build. -->
	<target name="init">
		<property name="FS" value="${file.separator}"/>
		<property name="src.dir" value="src"/> 
		<property name="build.dir" value="out${FS}production${FS}maestrodoc"/>
		<property name="support.dir" value="supporting"/>
		<property name="archive.dir" value="releases"/>
		<property name="md.version" value="123"/>
		<property name="rel.dir" value="${archive.dir}${FS}v${md.version}"/>
		<mkdir dir="${rel.dir}"/>
	</target> 

	<!-- This target saves the project source code as src-maestrodoc.jar in the current release folder. -->
	<target name="source" depends="init">
		<delete failonerror="false">
			<fileset dir="${rel.dir}" includes="src-maestrodoc.jar"/>
		</delete>
		<jar destfile="${rel.dir}${FS}src-maestrodoc.jar" duplicate="fail">
			<fileset dir="${src.dir}"/>
		</jar>
	</target>
	
	<!-- This target creates the supporting JAR file hhmi-ms-maestro.jar for the Matlab function MAESTRODOC(), then
	     puts the JAR file, maestrodoc.m, and exampledoc.m in a ZIP file tagged with the version: maestrodoc_nnn.zip.
	     Both the JAR and the ZIP are stored in the current release folder. -->
	<target name="ms" depends="init">
		<delete failonerror="false">
			<fileset dir="${rel.dir}" includes="hhmi-ms-maestro.jar, maestrodoc_${md.version}.zip"/>
		</delete>

		<jar destfile="${rel.dir}${FS}hhmi-ms-maestro.jar" basedir="${build.dir}" duplicate="fail"/>

		<zip destfile="${rel.dir}${FS}maestrodoc_${md.version}.zip">
			<fileset dir="${rel.dir}" includes="hhmi-ms-maestro.jar"/>
			<fileset dir="${support.dir}" includes="maestrodoc.m, examplemdoc.m"/>
			<fileset dir="." includes="CHANGELOG.md, README.md, LICENSE"/>
		</zip>
	</target>
	
	<!-- This target does it all! -->
	<target name="all" depends="ms,source,init"/>
</project> 

